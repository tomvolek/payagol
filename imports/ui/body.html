<body>


</body>
<template name="ApplicationLayout">

    <!-- Set up navbar area ,Check to see if user is admin , if so show the form to set an item on auction  -->

   {{#if isInRole 'admin' 'default-group'}}
      {{> navigation}}
      {{> yield }}
   {{else}}   <!-- user is none-admin -->
       {{> navigation_buyer}}
       {{> yield }}
       <!--user is not in admin role, so do not display the form to set an item on auction -->
   {{/if}}
  {{> footer}}
</template>

<template name="Main">
    {{> flower_batch_lists}}
    <!-- draw the clock interface -->
    {{> draw_clock}}
    {{> flower_auction_lists}}


    {{#if isInRole 'buyer' 'default-group'}}
            {{> form_buy_item}}
            {{> report_user_purchase}}
        {{else}}
    {{/if}}

    {{#if isInRole 'admin' 'default-group'}}
        {{> form_set_item_on_auction }}
        {{> barcode_scanner}}

    {{/if}}


</template>

<template name="footer">
    <br><br>
    <p><center>{{_ "Copyright  Payagol, 2017"}}</center></p>
</template>

<template name="draw_clock">

      <canvas id="myCanvas" width="600" height="600"></canvas>

</template>

<template name="addForm">
    <div style="margin:20px; text-align:center; background-color:#fcfcfc">
        <form class="form-inline addForm">
            <div class="form-group">
                <label for="name">Name</label>
                <input class="form-control" type="text" name="name" placeholder="Type name" />
            </div>
            <div class="form-group">
                <label for="score">Score</label>
                <input class="form-control" type="text" name="score" placeholder="0" />
            </div>
            <button type="submit" class="btn btn-default">Add</button>
        </form>
    </div>
</template>


<template name="localizedDateAndTime">

    {{localizedDateAndTime }}
</template>


    <template name="user_balance">
        <div id="user_balance">
        {{balance}}
        </div>
    </template>


<template name="form_buy_item">
    <div id="buyitem_container">
    <form id="buyitem">
        <input  type="text" id="num_container_field" name="buyitem"/>
        <input class="btn btn-danger"  type="submit" id="buy_item" value={{_ "Buy"}} />  
    </form>
    </div>
    <div id="BalanceLabel"><b> {{_ "Balance"}} :</b> {{> user_balance}} </div>

</template>

<!-- template to populate inside the clock -->
<template name="flower_auction_lists">

     {{#each OnAuction}}
         <div id="MonetaryUnitLabel"> {{_ "Monetary Unit"}}</div>
         <div id="MonetaryUnit_Value"> {{this.MoneteraryUnit}} </div>

         <div id="PricePerFlowerLabel">{{_ "Price/Flower"}}</div>
         <div class="clock_items"  id="PricePerFlower_Value"> {{this.PricePerFlower}} </div>

         <div id="BuyersNumberLabel">{{_ "Buyer Number"}}</div>
         <div class="clock_items"  id="BuyersNumber_Value"> {{this.Buyer_Number}} </div>

         <div  id="TrolleysLabel"> {{_ "Trolleys"}}</div>
         <div class="clock_items" id="Trolleys_Value"> {{this.Trolleys}} </div>

          <div id="ContainersPerTrollyLabel">{{_ "Containers/Trolley"}}</div>
          <div class="clock_items" id="ContainersPerTrolly_Value"> {{this.ContainersPerTrolly}} </div>

          <div id="TotalContainersLabel">{{_ "Total Containers"}}</div>
          <div class="clock_items" id="TotalContainers_Value"> {{this.TotalContainers}} </div>

          <div id="FlowerPerContainerLabel">{{_ "Flower/Container"}}</div>
          <div class="clock_items" id="FlowerPerContainer_Value"> {{this.FlowerPerContainer}} </div>

          <div id="MinContainerToBuyLabel">{{_ "Minimum Container To Buy"}}</div>
          <div class="clock_items" id="MinContainerToBuy_Value"> {{this.MinContainerToBuy}} </div>

         <div id="producer_container">
          <div id="producer_table">
           <table width= "360" border="2" >
                <thead id="head1">
                  <tr>
                    <th>{{_ "Supplier Name"}}</th>
                    <th>{{_ "ID"}}</th>
                    <th>{{_ "Country"}}</th>
                    </tr>
                </thead>
                <tbody>
                  <tr>
                    <td width="60%">{{this.Producer_name}}</td>
                    <td width="15%">{{this.Producer_id}}</td>
                    <td width="15%">{{this.Country}}</td>
                  </tr>
                </tbody>
            </table>
        </div>
          <div id="product_table">
           <table width= "360" border="2">
              <thead id="head2">
                    <tr>
                      <th >{{_ "Product"}}</th>
                      <th>{{_ "ID"}}</th>
                      <th>{{_ "Storage"}}</th>
                      <th>{{_ "Grade"}}</th>
                      </tr>
                </thead>
                <tbody>
                  <tr>
                    <td width="30%">{{this.ProductName}}</td>
                    <td width="15%">{{this.Product_id}}</td>
                    <td width="20%">{{this.Storage}}</td>
                    <td width="5%">{{this.Product_grade}}</td>
                  </tr>
                </tbody>
           </table>
          </div>
          <div id="product_image_table">
             <table width= "360" border="2">
                     <tbody>
                     <tr>
                         <td width="70%"><div id="ProductImage_Value"> <img src="/images/flower/{{this.ProductImage}}" height="160" width="160"/> </div></td>
                         <td width="20%"><div id="Logo_Value"> <img src="/images/logo/{{this.Logo}}" height="50" width="50"/> </div></td>
                     </tr>
                     </tbody>
                 </table>
          </div>
         </div>
     {{/each}}

    <div id="Payaneh_Date"> <strong> {{ localizedDateAndTime  }} </strong>  </div>
    <div id="Payaneh_Auction"> <img src="/images/payagol.png" height="100" width="90"/> </div>


</template>


<template name="flower_batch_lists">
        <table class="flower_batch_table" border="4" rows="3">
            <tr><th>{{_ "Product"}}</th><th>{{_ "ID"}}</th><th>{{_ "Total Containers"}}</th><th></th><th>{{_ "Flower/Container"}}</th><th>{{_ "Quality"}}</th><th>{{_ "Storage"}}</th><th>{{_ "Color"}}</th><th>{{_ "Producer"}}</th><th>{{_ "Logo"}}</th><th>{{_ "Form_Number" }}</th></tr>
        {{#each OneBatch}}
        <tr><td> {{this.ProductName}}</td><td>{{this.Product_id}}</td><td>{{this.TotalContainers}}</td><td> X </td><td>{{this.FlowerPerContainer}}</td><td>{{this.Quality}}</td><td>{{this.Storage}}</td><td  width="1%" class="{{this.color}}"></td><td><div class="Producer_name"> {{this.Producer_name}} </div></td><td><img src="/images/logo/{{this.Logo}}"></td><td>{{this.formnumber}}</td></tr>
        {{/each}}
        </table>
</template>



<template name ="form_enter_product">


    <br><br>
    <div class="container">
         <div class="panel panel-primary">
             <div class="panel-heading">
                 <h3 class="panel-title">{{_ "Insert/Update/Search Product"}}</h3>
             </div>
         <form id="myform">
       <table class="usertable" border="4">

           {{#each Search_Item_found}}
        <tr>
            <td>{{_ "Producer Name"}} <br><input type="text" name="Producer_name" value="{{this.Producer_name}}" required></td>
            <td>{{_ "Producer ID"}} <br><input type="text" name="Producer_id" value="{{this.Producer_id}}" required></td>
            <td>{{_ "Logo"}} <br><input type="text" name="Logo" value="{{this.Logo}}"/></td>
            <td>{{_ "Product Name"}} <br><input type="text" name="ProductName" value="{{this.ProductName}}"/></td>
            <td>{{_ "Product ID"}} <br><input id="Product_Id" type="text"  name="Product_id" value="{{this.Product_id}}" required></td>
        </tr>
         <tr>
             <td>{{_ "Product Image"}} <br><input type="text" name="ProductImage" value="{{this.ProductImage}}"/></td>
             <td>{{_ "Buyer Number"}} <br><input type="text" name="Buyer_Number" value="{{this.Buyer_Number}}"/></td>
             <td>{{_ "NumberOfItems"}} <br><input type="text" name="NumberOfItems" value="{{this.NumberOfItems}}"/></td>
             <td>{{_ "PricePerFlower"}} <br><input type="text" name="PricePerFlower" value="{{this.PricePerFlower}}"/></td>
             <td>{{_ "Trolleys"}} <br><input type="text" name="Trolleys" value="{{this.Trolleys}}" /></td>
          </tr>
        <tr>
            <td> {{_ "Containers/Trolley"}} <br><input type="text" name="ContainersPerTrolly" value="{{this.ContainersPerTrolly}}"/> </td>
            <td>{{_ "Total Containers"}} <br><input type="text" name="TotalContainers" value="{{this.TotalContainers}}"/></td>
            <td>{{_ "Flower/Container"}} <br><input type="text" name="FlowerPerContainer" value="{{this.FlowerPerContainer}}"/></td>
            <td>{{_ "Minimum Container To Buy"}} <br><input type="text" name="MinContainerToBuy" value="{{this.MinContainerToBuy}}"/></td>
            <td>{{_ "Quality"}} <br><input type="text" name="quality" value="{{this.quality}}"/></td>
         </tr>
         <tr>
             <td>{{_ "Storage"}} <br><input type="text" name="storage" value="{{this.storage}}"/></td>
             <td>s1 <br><input type="text" name="s1" value="{{this.s1}}"/></td>
             <td>{{_ "color"}} <br> <input type="text" name="color" value="{{this.color}}" /></td>
             <td>{{_ "Form_Number" }}<br><input type="text" name="formnumber" value="{{this.formnumber}}"/></td>
             <td>{{_ "Product Grade"}}<br><input type="text" name="Product_grade" value="{{this.Product_grade}}"/></td>

       </tr>
            <tr>
             <td>{{_ "Monetary Unit"}} <br><input type="text" name="MoneteraryUnit" value="{{this.MoneteraryUnit}}" /></td>
             <td>{{_ "Country"}} <br><input type="text" name="Country" value="{{this.Country}}"/></td>
             <td>{{_ "Creator Id"}}<br><input type="text" name="CreatorId" value="{{this.CreatorId}}"/></td>
             <td div class="date_field">{{_ "Created At"}}<br><input type="text" id="created-datepicker"   name="createdAt" value="{{this.createdAt}}"/> </td>
             <td >{{_ "Auction Date"}}<br><input type="text" id="auctiondate-datepicker"  name="AuctionDate" value="{{this.AuctionDate}}" /></td>
            </tr>
          <tr>
          </tr>
       {{/each}}

        </table>
      <!--  <p>{{_ "Upload product image" }}</p> -->

        {{> upload_bootstrap }}
        {{> dropzone contentType='images' fileTypes='.jpg' multiple=true formData=specificFormData }}

        <div style="text-align: center;">
         <input class="btn btn-danger" id="Search_Item" type="submit"  value= {{_ "Search"}} />
         <input class="btn btn-danger" id ="Edit_Item" type="submit"   value= {{_ "Edit"}} />
         <input class="btn btn-danger" id = "Add_Item" type="submit"   value= {{_ "Add"}} />
        </div>
         </form>
      </div>
    </div>

    {{> quickForm collection=Collections.FlowerBatchList id="form_enter_product" type="insert"}}

</template>



<template name ="form_edit_user">      
    <form id="userform">
        <h3>{{_ "Add/Edit Users"}}</h3>
       <table class="usertable" border="4">
        <tr><th>{{_ "ID"}}</th><th>{{_ "Name"}}</th><th>{{_ "Email"}}</th><th>{{_ "Role"}}</th><th>{{_ "Created At"}}</th>        </tr>   
        {{#each Search_User_found}}  
        <tr>  
            <td> <input id="#user_field" type="text" name="User_id"    value="{{this._id}}"/></td>
            <td> <input type="text" name="User_name"  value="{{username}}" /></td>
            <td> <input type="text" name="User_email" value="{{emails.[0].address}}"/></td>
            <td> <input type="text" name="User_role"  value="{{roles}}"/></td>
            <td> <input type="text" name="User_created" value="{{createdAt}}"/></td>
           
        </tr>
        {{/each}}
        
        </table>

        <div style="text-align: center;">
         <input class="btn btn-danger" id="Search_Item" type="submit"  value= {{_ "Search"}} />
         <input class="btn btn-danger" id ="Edit_Item" type="submit"   value= {{_ "Edit"}} />
         <input class="btn btn-danger" id = "Add_Item" type="submit"   value= {{_ "Add"}} />
        </div>
         
    </form>
</template>


<template name ="form_set_item_on_auction">
    <div id="on_auction_container">
    <div id="formset_item_on_auction">
        <b> {{_ "Product ID"}} </b>
    
    <form id="my_auction_price" >
        <input type="text" name="on_auction"/>
    <input type="submit" class="auction_price" value={{_ "Set Auction"}} />
    </form>
    
    <button class="btn btn-danger"  type="submit" value="-5" name="-5"> -5 </button>
    <button class="btn btn-danger"  type="submit" value="-1" name="-1"> -1 </button>
    <button class="btn btn-danger"  type="submit" value="1" name="+1"> +1 </button>
    <button class="btn btn-danger"  type="submit" value="5" name="+1"> +5 </button>
    </div>
    </div>
</template>



<!-- report all purchases for a day -->
<template name ="Report">
    <br><br>
    <div class="container">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">{{_ "Purchased Items"}}</h3>
            </div>
            <div class="panel-body">
                {{> reactiveTable collection=purchased class="table table-bordered table-hover" settings=tableSettings}}
            </div>
        </div>
    </div>
    {{yeild}}

</template>

<!--report all purchases for a day for the logged in user -->
<template name ="report_user_purchase">
    <br><br>
    <div class="report_container">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">{{_ "Purchased Items"}}</h3>
            </div>
            <div class="panel-body">
                {{> reactiveTable collection=purchased class="table table-bordered table-hover" settings=tableSettings}}
            </div>
        </div>
    </div>
</template>


<!--List all flowers in the catalog  -->
<template name ="Flowers_Catalog">
    <br><br>
    <div class="container">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">{{_ "Flowers Catalog"}}</h3>
            </div>
            <div class="panel-body">
                {{> reactiveTable collection=flowerscatalog class="table table-bordered table-hover" settings=tableSettings}}
            </div>
        </div>
    </div>

    <br><br>

    {{yeild}}

</template>



<template name="Register">
    <h2>Register</h2>
     You must register before being able to bid on items in the auction .
     
</template>



<template name="Login">
    <h2>Login</h2>
</template>




<template name="about">
    <center><div id="About_Payagol">
     <img src="/images/flower/payagol.jpg" height="100" width="100"/>

         <p><b>
             <h3><span>Who is Payagol  Market</span></h3>
        <p><strong></strong></p>
        <p>Payagol Market is a modern business where Iranian wholesalers and florists can find the widest and deepest assortment of cut flowers and cut greens. Payagol Market represents high quality, interesting offers, and an excellent, personalised service.</p>
        <p>&nbsp;</p>
        <h4 style="font-size: 16px; color: #ff5d00; margin-top: 15px;">Payagol Florist Market is:</h4>
        <ul class="contentList">
            <li>A reliable partner.</li>
            <li>Largest assortment in Europe.</li>
            <li>A hyper-modern, real-time purchasing system.</li>
            <li>Personalised service.</li>
            <li>Daily, deeply discounted offers.</li>
        </ul>

         </b>
         </p>
    </div>
    </center>
</template>


<template name="Home">
    <p>Welcome to Payaneh Auction </p>
</template>


<template name="auction_list">
    <!-- Add login mechanism  -->

    <div id='next3batches'> <label>{{_ "Next Three Items for Auction"}} </label></div>
    {{> flower_batch_lists}}

    <!-- draw the clock interface -->
    {{> flower_auction_lists}}
    {{> form_buy_item}}

</template>

<template name="navigation">
    <nav class="navbar navbar-custom navbar-static-top" style="margin-bottom: 0px; font-size: 12px; height: 20px;">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>
        <div class="collapse navbar-collapse" >
            <div id="welcome">{{_ "Welcome:"}}</div>&nbsp;&nbsp;&nbsp;&nbsp;
            <div id="loginButtons"><b> {{> loginButtons}} </b></div>
            <ul class="nav navbar-nav">
                <li class="active"><a href="{{pathFor route='main'}}">{{_ "Home"}}</a></li>

                {{#if isInRole 'admin' 'default-group'}}
                    <!-- Reports  -->
                    <li> <a href="{{pathFor route='report'}}">{{_ "Report"}}</a></li>
                    <li><a href="{{pathFor route='flowers_catalog'}}">{{_ "Flowers Catalog"}}</a></li>
                    <li> <a href="{{pathFor route='form_enter_product'}}">{{_ "Edit/Search Items"}}</a></li>
                    <li><a href="{{pathFor route='about'}}">{{_ "About"}}</a>  </li>
                 <!--   <li> <a href="{{pathFor route='form_edit_user'}}">{{_ "Edit Users"}}</a></li> -->

                {{/if}}
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <div id="languages"> {{> i18n_dropdown_bootstrap3_component}} </div>

            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>
</template>


<template name="navigation_buyer" >
    <nav class="navbar navbar-custom navbar-static-top" style="margin-bottom: 0px; font-size: 12px; height: 20px;">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse" >
            <div id="welcome">{{_ "Welcome:"}}</div>&nbsp;&nbsp;&nbsp;&nbsp;
            <div id="loginButtons"> <b>{{> loginButtons}} </b></div>
            <ul class="nav navbar-nav">
                <li class="active"><a href="{{pathFor route='main'}}">{{_ "Home"}}</a></li>
                <li><a href="{{pathFor route='flowers_catalog'}}">{{_ "Flowers Catalog"}}</a></li>
                <li><a href="{{pathFor route='about'}}">{{_ "About"}}</a>  </li>
                {{#if isInRole 'admin'}}
                    <!-- Reports  -->
                    <li> <a href="{{pathFor route='report'}}">{{_ "Report"}}</a></li>
                    <li> <a href="{{pathFor route='form_enter_product'}}">{{_ "Edit/Search Items"}}</a></li>
                    <!--   <li> <a href="{{pathFor route='form_edit_user'}}">{{_ "Edit Users"}}</a></li> -->

                {{/if}}
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <div id="languages"> {{> i18n_dropdown_bootstrap3_component}} </div>

            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>
</template>

<template name="online_users">
    <h1>{{_ "There are currently"}} {{usersOnlineCount}} {{_ "users in Auction"}}</h1>
    <ul>
        {{#each usersOnline}}
            <li> <div class="boxed">{{username}}  </div>
                {{#with currentUser}}
                <p>{{> avatar  user=this size="small" shape="rounded"}}</p>

                    {{#if isUserInRole _id 'buyer'}} Buyer.. {{/if}}
                    {{#if isUserInRole _id 'admin'}} Admin.. {{/if}}
            {{/with}}
            </li>
        {{/each}}
    </ul>
    <button onclick="TogetherJS(this); return false;">Start Talk</button>
</template>


<template name="_loginButtonsAdditionalLoggedInDropdownActions">
    <button class="btn btn-default btn-block" id="login-buttons-edit-profile">{{_ "Edit profile"}}</button>
</template>

<template name="barcode_scanner">
    <button>Scan</button>
    {{> xvendo_barcoder id="idme" ean="1234567890123"}}
</template>

<template name="clock">
    <!-- place holder , it does nothing at the moment -->

</template >

<template name="user_banking">
    <p> Users current Bank Balance : </p>
    {{> user_banking }}

</template>